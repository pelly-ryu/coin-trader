<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>options</title>
</head>
<body>
<p>
    원래는 옵션을 위한 페이지지만 그냥 기능용으로 써보기로 합니다.<br>
    문제가 생기면 그때 생각하기로 합니다.<br>
    첫 10초는 그냥 기다립니다.<br>
    10초마다 갱신하는데, 알아서 고쳐 쓰세용<br>
    주소는 유투브에서 퍼가기 누르면 나오는 iframe 중의 src입니다.<br>
    /embed/ 를 포함해야 합니다<br>
    e.g. https://www.youtube.com/embed/NMsFe8Uyrg8
</p>
<br>
<label for="now">현재가</label> <input id="now" type="text">
<br>
<p>
    1. <label for="target_1">하단 목표가</label><input id="target_1" type="text"><br>
    <label for="address_1">알림 주소</label><input id="address_1" type="text"><br>
    <br><br>
    2. <label for="target_2">상단 목표가</label><input id="target_2" type="text"><br>
    <label for="address_2">알림 주소</label><input id="address_2" type="text"><br>
</p>

<iframe id="youtube" width="420" height="315"
        src="">
</iframe>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
  function httpGetAsync (theUrl, callback) {
    const headers = {
      'content-type': 'application/json'
    }
    const axiosInstance = axios.create({
      baseURL: theUrl,
      timeout: 10000,
      headers: headers
    })

    axiosInstance.get('')
      .then(callback)
  }

  const runner = setInterval(() => {
    const target1 = document.getElementById('target_1').value
    const address1 = document.getElementById('address_1').value
    const target2 = document.getElementById('target_2').value
    const address2 = document.getElementById('address_2').value

    console.log('request start')
    httpGetAsync('http://api.coinone.co.kr/ticker/?format=json&currency=iota', (res) => {
      console.log('callback start')

      console.log(res)
      document.getElementById('now').value = res['data']['last']

      const now = parseFloat(res['data']['last'])

      const iFrame = document.getElementById('youtube')
      if (target1.length > 0 && address1.length > 0) {
        if (now <= parseFloat(target1)) {
          console.log('address1')
          if (!iFrame.src.includes(address1)) {
            iFrame.src = address1 + '?loop=1&autoplay=1'
          }
        }
      }

      if (target2.length > 0 && address2.length > 0) {
        if (now >= parseFloat(target2)) {
          console.log('address2')
          if (!iFrame.src.includes(address2)) {
            iFrame.src = address2 + '?loop=1&autoplay=1'
          }
        }
      }
    })

  }, 10000)
</script>
</body>
</html>
